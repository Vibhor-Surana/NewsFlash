<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Frontend Tests - NewsFlash</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fb;
        }
        .header {
            background: #2563eb;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .test-controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 14px;
        }
        .btn:hover {
            background: #1d4ed8;
        }
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß™ Language Frontend Tests</h1>
        <p>Test runner for NewsFlash language switching functionality</p>
    </div>

    <div class="test-controls">
        <h3>Test Controls</h3>
        <button id="runTests" class="btn">Run All Tests</button>
        <button id="clearOutput" class="btn">Clear Output</button>
        <button id="loadApp" class="btn">Load NewsApp</button>
        
        <div id="status" class="status info">
            Ready to run tests. Click "Load NewsApp" first if not already loaded.
        </div>
    </div>

    <div class="test-output" id="testOutput">
Welcome to Language Frontend Tests!

This test runner will execute JavaScript tests for the language switching functionality.

Instructions:
1. Make sure the NewsFlash application is running on localhost:5000
2. Click "Load NewsApp" to initialize the application components
3. Click "Run All Tests" to execute the test suite
4. Review the test results in this console

Note: Some tests may require the full application context to run properly.
    </div>

    <!-- Include Bootstrap for dropdown functionality -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Include the NewsFlash application scripts -->
    <script>
        // Mock the application environment
        let mockNewsApp = null;
        let testRunner = null;

        // Redirect console output to our test output div
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };

        function redirectConsole() {
            const output = document.getElementById('testOutput');
            
            console.log = (...args) => {
                originalConsole.log(...args);
                output.textContent += args.join(' ') + '\n';
                output.scrollTop = output.scrollHeight;
            };
            
            console.error = (...args) => {
                originalConsole.error(...args);
                output.textContent += '‚ùå ERROR: ' + args.join(' ') + '\n';
                output.scrollTop = output.scrollHeight;
            };
            
            console.warn = (...args) => {
                originalConsole.warn(...args);
                output.textContent += '‚ö†Ô∏è WARN: ' + args.join(' ') + '\n';
                output.scrollTop = output.scrollHeight;
            };
        }

        function restoreConsole() {
            console.log = originalConsole.log;
            console.error = originalConsole.error;
            console.warn = originalConsole.warn;
        }

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        function createMockNewsApp() {
            // Create minimal DOM structure needed for tests
            if (!document.querySelector('.language-selector')) {
                const mockHeader = document.createElement('div');
                mockHeader.innerHTML = `
                    <div class="language-selector">
                        <div class="dropdown">
                            <button class="btn btn-outline-light btn-sm dropdown-toggle language-btn" type="button" 
                                    id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-globe me-1"></i>
                                <span class="language-text">English</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end language-menu" aria-labelledby="languageDropdown">
                                <li><h6 class="dropdown-header">Select Language</h6></li>
                                <li><hr class="dropdown-divider"></li>
                            </ul>
                        </div>
                    </div>
                `;
                document.body.appendChild(mockHeader);
            }

            // Create mock NewsApp instance
            mockNewsApp = {
                currentLanguage: 'en',
                supportedLanguages: {
                    'en': { name: 'English', native: 'English' },
                    'hi': { name: 'Hindi', native: '‡§π‡§ø‡§Ç‡§¶‡•Ä' },
                    'mr': { name: 'Marathi', native: '‡§Æ‡§∞‡§æ‡§†‡•Ä' }
                },
                currentTopics: [],
                
                getLanguageFlag(code) {
                    const flags = { 'en': 'üá∫üá∏', 'hi': 'üáÆüá≥', 'mr': 'üáÆüá≥' };
                    return flags[code] || 'üåê';
                },
                
                updateLanguageButtonText() {
                    const languageText = document.querySelector('.language-text');
                    if (languageText && this.supportedLanguages[this.currentLanguage]) {
                        languageText.textContent = this.supportedLanguages[this.currentLanguage].name;
                    }
                },
                
                populateLanguageDropdown() {
                    const languageMenu = document.querySelector('.language-menu');
                    if (!languageMenu) return;
                    
                    const existingItems = languageMenu.querySelectorAll('.language-item');
                    existingItems.forEach(item => item.remove());
                    
                    Object.entries(this.supportedLanguages).forEach(([code, lang]) => {
                        const listItem = document.createElement('li');
                        listItem.className = 'language-item';
                        
                        const button = document.createElement('button');
                        button.className = `dropdown-item ${code === this.currentLanguage ? 'active' : ''}`;
                        button.type = 'button';
                        button.dataset.language = code;
                        
                        const flagEmoji = this.getLanguageFlag(code);
                        
                        button.innerHTML = `
                            <span class="language-flag">${flagEmoji}</span>
                            <div class="language-names">
                                <span class="language-name">${lang.name}</span>
                                <span class="language-native">${lang.native}</span>
                            </div>
                        `;
                        
                        listItem.appendChild(button);
                        languageMenu.appendChild(listItem);
                    });
                },
                
                updateLanguageDropdownSelection() {
                    document.querySelectorAll('.dropdown-item[data-language]').forEach(item => {
                        item.classList.remove('active');
                        if (item.dataset.language === this.currentLanguage) {
                            item.classList.add('active');
                        }
                    });
                },
                
                async playTTS(text, button) {
                    // Mock TTS functionality
                    return Promise.resolve();
                },
                
                async searchNews() {
                    // Mock search functionality
                    return Promise.resolve();
                },
                
                fetchWithRetry(url, options) {
                    // Mock fetch with basic responses
                    return Promise.resolve({
                        ok: true,
                        json: () => Promise.resolve({ success: true })
                    });
                }
            };

            window.newsApp = mockNewsApp;
            return mockNewsApp;
        }

        async function loadNewsApp() {
            updateStatus('Loading NewsApp...', 'info');
            
            try {
                // Create mock app if needed
                if (!window.newsApp) {
                    createMockNewsApp();
                }
                
                // Initialize language dropdown
                if (window.newsApp.populateLanguageDropdown) {
                    window.newsApp.populateLanguageDropdown();
                }
                
                updateStatus('NewsApp loaded successfully!', 'success');
                return true;
            } catch (error) {
                updateStatus(`Failed to load NewsApp: ${error.message}`, 'error');
                return false;
            }
        }

        async function runTests() {
            if (!window.newsApp) {
                updateStatus('NewsApp not loaded. Loading now...', 'info');
                const loaded = await loadNewsApp();
                if (!loaded) return;
            }

            updateStatus('Running tests...', 'info');
            redirectConsole();

            try {
                // Load and run the language tests
                if (!window.LanguageTests) {
                    // Load the test script dynamically
                    const script = document.createElement('script');
                    script.src = '/static/js/language-tests.js';
                    document.head.appendChild(script);
                    
                    // Wait for script to load
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = reject;
                        setTimeout(reject, 5000); // 5 second timeout
                    });
                }

                if (window.LanguageTests) {
                    testRunner = new window.LanguageTests();
                    const results = await testRunner.runAllTests();
                    
                    if (results.failed === 0 && results.errors === 0) {
                        updateStatus(`All tests passed! (${results.passed}/${results.total})`, 'success');
                    } else {
                        updateStatus(`Tests completed with issues: ${results.failed} failed, ${results.errors} errors`, 'error');
                    }
                } else {
                    throw new Error('LanguageTests class not available');
                }
                
            } catch (error) {
                console.error('Test execution failed:', error);
                updateStatus(`Test execution failed: ${error.message}`, 'error');
            } finally {
                restoreConsole();
            }
        }

        function clearOutput() {
            document.getElementById('testOutput').textContent = 'Output cleared.\n\n';
            updateStatus('Output cleared', 'info');
        }

        // Set up event listeners
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('runTests').addEventListener('click', runTests);
            document.getElementById('clearOutput').addEventListener('click', clearOutput);
            document.getElementById('loadApp').addEventListener('click', loadNewsApp);
            
            // Auto-load app after a short delay
            setTimeout(loadNewsApp, 1000);
        });
    </script>
</body>
</html>